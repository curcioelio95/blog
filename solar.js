let solarInit=!1,solarIncludeCounter=0;function solar(){let prefix="solar";function init(){initIncludes(),initRouting(),solarInit||(handleInitialRoute(),triggerDefaultLink(),solarInit=!0)}function initIncludes(){let e=document.querySelectorAll(`[${prefix}-html]:not([${prefix}-include]`);e.forEach(e=>{let t=e.getAttribute(`${prefix}-html`);includeHTML(t,e)})}function includeHTML(url,element){fetch(url).then(e=>e.text()).then(data=>{element.setAttribute(`${prefix}-include`,solarIncludeCounter++),data=styleExtractor(data,`[${prefix}-include="${solarIncludeCounter-1}"]`),[data,script]=scriptExtractor(data);let observer=new MutationObserver(mutations=>{for(let mutation of mutations)if("childList"===mutation.type&&mutation.addedNodes.length>0){initRouting(),eval(script),observer.disconnect();break}});observer.observe(element,{childList:!0}),element.innerHTML=data}).catch(e=>{console.error("Errore nel caricamento dell'HTML:",e)})}function initRouting(){let e=document.querySelectorAll(`[${prefix}-page]`);e.forEach(e=>e.addEventListener("click",handleLinkClick)),window.addEventListener("popstate",handleInitialRoute)}function handleLinkClick(e){e.preventDefault();let t=e.target,r=t.getAttribute("href"),l=t.getAttribute(`${prefix}-page`),n=t.getAttribute(`${prefix}-selector`)||"main";if(!l)return!1;let i=document.querySelectorAll(`[${prefix}-selector="${n}"]`);i.forEach(e=>e.removeAttribute(`${prefix}-active`)),t.setAttribute(`${prefix}-active`,!0),loadPage(l,n,r)}function loadPage(url,selector,href=null){let contentElement=document.querySelector(selector);href&&(href=encodeURIComponent(href),contentElement.setAttribute("href",href),history.pushState({},"",`index.html?page=${href}`)),contentElement.classList.add("fade-out"),fetch(url).then(e=>{if(!e.ok)throw Error(`La risorsa ${url} non esiste`);return e.text()}).then(data=>{data=styleExtractor(data,selector),[data,script]=scriptExtractor(data),contentElement.classList.remove("fade-out");let observer=new MutationObserver(mutations=>{for(let mutation of mutations)if("childList"===mutation.type&&mutation.addedNodes.length>0){initIncludes(),initRouting(),eval(script),observer.disconnect();break}});observer.observe(contentElement,{childList:!0}),contentElement.innerHTML=data,contentElement.classList.add("fade-in")}).catch(e=>{console.error("Errore nel caricamento del contenuto:",e)})}function handleInitialRoute(){let e=new URLSearchParams(location.search),t=e.get("page");if(t){let r=document.querySelector(`[href='${t}']`);if(r){let l=r.getAttribute("href"),n=r.getAttribute(`${prefix}-page`),i=r.getAttribute(`${prefix}-selector`)||"main";loadPage(n,i,l)}}}function scriptExtractor(e){let t=e.indexOf("<script>"),r=e.indexOf("</script>"),l=null;return t>0&&r>0&&(l=e.substring(t+8,r),e=(e=e.replace(l,"")).replace("<script></script>","")),[e,l]}function styleExtractor(e,t){let r=e.indexOf("<style>"),l=e.indexOf("</style>");if(r>0&&l>0){let n=e.substring(r+7,l);e=(e=e.replace(n,"")).replace("<style></style>",""),e+="<style>"+beautifyCSS(n=n.replace(/\s*([^}]+)\s*\{([^}]+)\}/g,(e,r,l)=>{let n=r.split(",").map(e=>e.trim()),i=n.map(e=>{if(e.startsWith("@import")&&e.split("\n")){let r=e.split("\n");return console.log(r),r[0]+"\n\r"+t+r.at(-1)}if(e.startsWith("@")&&e.split("{").length>1){let l=e.split("{")[1].trim();return"\n\r"+e.split("{")[0]+"{ \n\r\r"+t+" "+l}return t+" "+e});return i.join(", ")+" {"+l+"} \n\n"}))+"</style>"}return e}function beautifyCSS(e){let t="",r=0,l=e.split("\n"),n="";for(let i of l){if((i=i.trim()).startsWith("@import"))t+=i+"\n";else{i.includes("}")&&r--;let s=i.replace(/\s+/g," ");t+="    ".repeat(Math.max(r,0))+s+"\n",i.includes("{")&&r++}(""!==i||""!==n)&&(n=i)}return t.trim()}function triggerDefaultLink(){let e=new URLSearchParams(location.search),t=e.get("page");if(t){let r=document.querySelector(`[href='${t}']`),l=document.querySelectorAll(`[${prefix}-default]:not([solar-selector='${r.getAttribute("solar-selector")}'])`);console.log(l),l.forEach(e=>e.click())}else{let n=document.querySelectorAll(`[${prefix}-default]`);n.forEach(e=>e.click())}}init()}solar();