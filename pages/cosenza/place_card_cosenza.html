<div class="map__container">
    <div id='map' ></div>
    <div id="text-container">
        <div id="text_info_card">
            <h2 id="title_info">Everything starts fom here!</h2>
            <p id="subtitle_info">What are you looking for?</p>
            <p id="desctiption_info">This map contains a collection of the most beautiful places to visit, if you are looking for a good place to eat, or a simple suggestion for a place to spend your time, it doesn't matter! The map has everything! </p>
            <div class="map__controls">
                <button id="style1-button"><i class="fas fa-map-marked-alt"></i> Explore</button>
                <button id="style2-button"> <i class="fas fa-utensils"></i> Eat</button>
                <button id="style3-button">  <i class="fas fa-camera"></i> Shots</button>
                <button id="style4-button">  <i class="fas fa-motorcycle"></i> Trip</button>
            </div>
        </div>
    </div>
</div>

<style>
    a,p{
        font-family: Roboto;
        color: var(--text-gray) !important;
        font-size: 1em;
        font-weight: 300;
        letter-spacing: 1px;
    }
    a{
        font-weight: bold;
    }
    strong{
        font-family: Roboto;
        color: var(--text-gray) !important;
        font-size: 1.3em;
        font-weight: bold;
        font-weight: 300;
        letter-spacing: 1px;
    }
    .map__container{
        position: relative;
        height: 100vh;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    
    }

    #map{
        flex:2;
        width: 50%;
        height: 80%;
        object-fit: cover;
        border-radius: 20px;
        box-shadow: 10px 10px 15px rgba(0,0,0,0.5);
    }

    #text-container {
            flex: 0.5;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            width: 100%;
        }

        #text-container h2{
            font-size: 30px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-family: Montserrat;
            color: var(--text-gray);
        }

        #text-container p{
            font-family: Roboto;
            color: var(--text-gray) !important;
            font-size: 16px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        #text_info_card {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }

        #button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #button:hover {
            background-color: #0056b3;
        }

        .map__controls {
            display: grid !important;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

    .map__controls button {
    margin: 0.2em;
    padding: 0.9em 2em;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s;
    border-radius: 2em;
    }

    #style2-button {
    background-color: #28a745;
    }

    #style3-button {
    background-color: #dc3545;
    }

    #style4-button {
    background-color: #FFA500;
    }

    button:hover {
    background-color: #0056b3;
    }

    button#style2-button:hover {
    background-color: #218838;
    }

    button#style3-button:hover {
    background-color: #c82333;
    }

    button#style4-button:hover {
    background-color: #a36a00;
    }
        
    .symbol {
        text-decoration: none; /* Rimuove la sottolineatura del link */
        color: transparent; /* Rende il testo del link trasparente */
    }

</style>

<script>
    var img_w;
    var img_h;
    // Verifica la larghezza dello schermo
    if (window.innerWidth <= 900) { // Larghezza massima di un iPhone
        img_w = 200; // Dimensione per schermi di iPhone
        img_w = 168;
    } else {
        img_w = 220; // Dimensione per schermi più grandi
        img_h = 185;
    }

    mapboxgl.accessToken = 'pk.eyJ1IjoiZWxpb21hdHRlbzk1IiwiYSI6ImNsbHAzbTZjbDAxeGMzbXF6dTF0aTJ6OTEifQ.UbtyyNO3zrxCy9csW01oaA';
    const map = new mapboxgl.Map({
    container: 'map',
    // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [16.25704652568126, 39.29397419000367],
    zoom: 12.4
    }); 

  
    const mpSets = [
    //place to visit
    [
        // Array di posizioni per lo Style 1
        {
            'name':'loc 1', 
            'coordinates': [16.250893166752007, 39.29852011896949],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>S. Teresa church</strong>'
            },
        },
        {
            'name':'loc 2', 
            'coordinates': [16.253082263194415, 39.300183889469935],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Piazza Kennedy</strong>'
            },
        },
        {
            'name':'loc 3', 
            'coordinates': [16.25208929691391, 39.30238656181976],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Piazza Fera</strong>'
            },
        },
        {
            'name':'loc 4', 
            'coordinates': [16.258147029621743, 39.28637664188248],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Svevo Castle</strong>'
            },
        },
        {
            'name':'loc 5', 
            'coordinates': [16.261838123018165, 39.28650811027968],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Rendano theatre</strong>'
            },
        },
        {
            'name':'loc 6', 
            'coordinates': [16.26353030925179, 39.28550125431792],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Villa Vecchia</strong>'
            },
        },
        {
            'name':'loc 7', 
            'coordinates': [16.263889553498842, 39.289515509781836],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Museum of Bretti and Enotri</strong>'
            },
        },
        {
            'name':'loc 8', 
            'coordinates': [16.259926778615238, 39.289063908059234],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Cathedral</strong>'
            },
        },
        {
            'name':'loc 9', 
            'coordinates': [16.262057674494827, 39.291792102347216],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>Rendano\'s home</strong>'
            },
        },
        {
            'name':'loc 10', 
            'coordinates': [16.2618544855724, 39.29068267518687],
            'color': '#007bff',
            'properties': {
            'description':
            '<strong>National gallery</strong>'
            },
        },
       
    ],
    // place to eat
    [
    {
            'name':'Borgo rosso di sera', 
            'coordinates': [16.07182033309263, 39.286312960759034],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>Borgo Rosso di Sera</strong><p>Great place to try typical products. <a href="http://www.borgorossodisera.com/" target="_blank" title="clicca qui" rel="nofollow"> website</a></p>'
            },
        },    
    {
            'name':'La gulia', 
            'coordinates': [16.25483911682676, 39.29204901646318],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>A gulia</strong><p>Great place to try typical products. <a href="https://www.facebook.com/people/A-Gulia/100054881659522/" target="_blank" title="clicca qui" rel="nofollow"> website</a></p>'
            },
        },
        {
            'name':'Il Cugino', 
            'coordinates': [16.250639023612166, 39.236666401220816],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>Osteria dal Cugino</strong><p>Great place to try typical products. <a href="https://www.osteriadalcugino.it/" target="_blank" title="clicca qui" rel="nofollow"> website</a></p>'
            },
        },
        {
            'name':'Campanaro', 
            'coordinates': [16.441248062620843, 39.33831909443026],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>Campanaro</strong><p>Great place to try typical Sila\'s products. <a href="https://www.facebook.com/silafunghicampanaro.prodottitipicicalabresi/" target="_blank" title="clicca qui" rel="nofollow"> website</a></p>'
            },
        },
        {
            'name':'Barrese', 
            'coordinates': [16.424183338184548, 39.34082616011915],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>Salumeria Barrese</strong><p>Great place to try typical Sila\'s products. <a href="https://www.facebook.com/AnticaSalumeriaBarrese/" target="_blank" title="clicca qui" rel="nofollow"> website</a></p>'
            },
        },
        {
            'name':'vecchio ulivo', 
            'coordinates': [16.263342, 39.263735],
            'color': '#28a745',
            'properties': {
            'description':
            '<strong>Al Vecchio Ulivo</strong><p>Great place to try typical products. <a href="https://www.facebook.com/people/Al-vecchio-ulivo/100054470499583/" target="_blank" title="clicca qui"> website</a></p>'
            },
        }
    ],
    //place to shot
    [
        {
            'name':'loc ', 
            'coordinates': [16.257499655780663,39.28692244554949],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Castello Svevo</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="images/cosenza/pic_cs_2.jpg"/></div><p>Come and discover this place <a href="http://www.castellocosenza.it/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [16.06715574534971,39.234287479396784],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Fiumefreddo Bruzio</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="images/cosenza/pic_cs_15.png"/></div><p>Come and discover this place <a href="https://borghipiubelliditalia.it/borgo/fiumefreddo-bruzio/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [16.511167345148863,39.24903420153629],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Lorica</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="images/cosenza/pic_cs_11.png"/></div><p>Come and discover this place  <a href="https://www.jamaluca.com/lorica-lago-arvo/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [16.132401967899085,39.21839237474916],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Cocuzzo Mountain</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="images/pic2.jpg"/></div><p>Come and discover this place  <a href="https://www.calabriaportal.com/montagne-della-calabria/catena-costiera-appennino-paolano/1208-monte-cocuzzo.html" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [16.54738136416006,39.38535935755124],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>National Park</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="images/cosenza/pic_cs_3.jpg"/></div><p>Come and discover this place  <a href="https://www.parcosila.it/it/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [16.069710765194372, 39.85425410373412],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Lavender park</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="https://th.bing.com/th/id/OIP.aWdHV6VdDbkRQt52XETargHaHa?pid=ImgDet&rs=1"/></div><p>Come and discover this place <a href="https://parcodellalavanda.it/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        },
        {
            'name':'loc ', 
            'coordinates': [15.792102619838204,39.85488110500802],
            'color': '#dc3545',
            'properties': {
            'description':
            '<strong>Arco Magno</strong><div style="text-align:center"><img width="'+img_w+'" height="'+img_h+'" src="https://i.pinimg.com/736x/39/e5/b8/39e5b88c0ace231d77566ce1a32ce1bf.jpg"/></div><p>Come and discover this place <a href="https://iitalycalabria.com/cosenza-province/arco-magno-beach/" target="_blank" title="scopri il castello" rel="nofollow">here</a>.</p>'
            },
        }
    ],
    //place to go
    [
        {
            'name':'Camigliatllo', 
            'coordinates': [16.44396137834741, 39.339140069521505],
            'color': '#FFA500',
            'properties': {
            'description':
            '<strong>Camigliatello Silano</strong><div style="text-align:center"></div><div><a id="try" style="cursor: pointer;"> Ride here </a></div>',
            
             },
        },
        {
            'name':'Amantea', 
            'coordinates': [16.07605117497829, 39.133969576929445],
            'color': '#FFA500',
            'properties': {
            'description':
            '<strong>Amantea</strong><div style="text-align:center"></div><p>Ride here.</p>'
            },
        }
    ]
];
   

let currentMarkers = [];

function clearMarkers() {
    // Trova tutti gli elementi dei marker con la classe mapboxgl-marker
    const markerElements = document.querySelectorAll('.mapboxgl-marker');

    // Itera attraverso gli elementi e rimuovili
    markerElements.forEach((markerElement) => {
        markerElement.remove();
    });

    if (map.getLayer('markers')) {
        map.removeLayer('markers');
    }
    if (map.getSource('markers')) {
        map.removeSource('markers');
    }

    map.on('load', () => {})
    currentMarkers = []; // Svuota l'array dei marker correnti
}

function addMarkersToSource(mpSet) {
    clearMarkers();
    
    const sourceId = 'markers';
    const features = mpSet.map((e) => {
        const name_marker=e.name;
        const coordinates = e.coordinates.slice();
        const description = e.properties.description;
        const color = e.color;

        const popup = new mapboxgl.Popup({ closeOnClick: true })
            .setHTML(description);

        const marker = new mapboxgl.Marker({
            color

        })
            .setLngLat(coordinates)
            .setPopup(popup)
            .addTo(map);

        return {
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: coordinates
            },
            properties: {
                title: e.name,
                description: e.properties.description,
                color: e.color
            }
        };

        const customMarkerElement = document.createElement('div');
        customMarkerElement.className = 'custom-marker';
        customMarkerElement.setAttribute('data-marker-id',name_marker); // Aggiungi l'attributo data-marker-id

        customMarkerElement.addEventListener('click', () => {
            const markerId = customMarkerElement.getAttribute('data-marker-id');
            console.log(`Selected marker ID: ${markerId}`);
            // Puoi fare qualcosa con l'ID del marcatore, ad esempio mostrare dettagli o effettuare un'azione specifica.
        });
    });

    map.addSource(sourceId, {
        type: 'geojson',
        data: {
            type: 'FeatureCollection',
            features: features
        }
    });

    map.addLayer({
        id: 'markers',
        type: 'symbol',
        source: sourceId,
        layout: {
            // Imposta il layout del tuo layer
        }
    });
    map.on('click','markers', (e) => {
        console.log(e);
    });

    map.setZoom(8.45);
    map.setCenter([16.25704652568126, 39.29397419000367]);
    currentMarkers = mpSet;
    console.log(currentMarkers);
    
    map.on('load', () => {
        
    });

    map.on('click', map.getLayer('markers'), function(e) {
        console.log('ok2');
    });

    document.querySelectorAll('.mapboxgl-marker').forEach((markerElement) => {
    markerElement.addEventListener('click', () => {
        console.log(markerElement.getElement());
    });
})
}
    
// map.on('click', function (e) {
//     var features = map.queryRenderedFeatures(e.point, {
//         layers: ['markers'] // Specifica il nome del tuo layer
//     });

//     if (features.length > 0) {
//         var feature = features[0]; // Prendi la prima feature trovata
//         var markerId = feature.properties.id; // Sostituisci "id" con il nome della tua proprietà
//         alert('Hai cliccato sul marker con ID: ' + markerId);
//     } else {
//         // Il clic non è avvenuto su un marker
//         alert('Clic non su un marker.');
//     }
// });



document.getElementById('style1-button').addEventListener('click', () => {
    addMarkersToSource(mpSets[0]);
});

document.getElementById('style2-button').addEventListener('click', () => {
    addMarkersToSource(mpSets[1]);
});

document.getElementById('style3-button').addEventListener('click', () => {
    addMarkersToSource(mpSets[2]);
});

document.getElementById('style4-button').addEventListener('click', () => {
    addMarkersToSource(mpSets[3]);
});
    
addMarkersToSource(mpSets[0]) ;


</script>